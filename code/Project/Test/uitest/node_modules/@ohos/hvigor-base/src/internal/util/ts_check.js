"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.hvigorfileTypeCheck=exports.targetModules=exports.targetRoots=exports.hvigorfileTSRoots=void 0;const process_1=__importDefault(require("process")),compile_options_js_1=require("../../util/options/compile-options.js"),time_util_js_1=require("../../util/time-util.js"),typescript_1=__importDefault(require("typescript")),hvigor_log_js_1=require("../../log/hvigor-log.js"),log=hvigor_log_js_1.HvigorLogger.getLogger("ts-check");function hvigorfileTypeCheck(){const e=process_1.default.hrtime(),t={getCanonicalFileName:e=>e,getCurrentDirectory:typescript_1.default.sys.getCurrentDirectory,getNewLine:()=>typescript_1.default.sys.newLine},o=typescript_1.default.createProgram([...exports.targetRoots],compile_options_js_1.compilerOptions),r=typescript_1.default.getPreEmitDiagnostics(o),i=process_1.default.hrtime(e),s=(0,time_util_js_1.formatTime)(i);for(const e of r)log.error(formatDiagnostic(e,t));r.length?log.errorMessageExit("Please fix above type errors."):log.info(`TYPE CHECK SUCCESSFUL in ${s}`)}function formatDiagnostic(e,t){const o=`${diagnosticCategoryName(e)} TS${e.code}: ${typescript_1.default.flattenDiagnosticMessageText(e.messageText,t.getNewLine())}${t.getNewLine()}`;if(e.file){const{line:t,character:r}=typescript_1.default.getLineAndCharacterOfPosition(e.file,e.start);return`${e.file.fileName}:${t+1}:${r+1} ${o}`}return o}function diagnosticCategoryName(e,t=!0){const o=typescript_1.default.DiagnosticCategory[e.category];return t?o.toLowerCase():o}exports.hvigorfileTSRoots=new Set,exports.targetRoots=new Set,exports.targetModules=new Set,exports.hvigorfileTypeCheck=hvigorfileTypeCheck;