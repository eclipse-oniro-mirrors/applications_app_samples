"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CompileJavaWithJavac=void 0;const ohos_logger_js_1=require("../../utils/log/ohos-logger.js"),process_utils_js_1=require("../../utils/process-utils.js"),java_compile_command_builder_js_1=require("../../builder/java-compile-command-builder.js"),path_1=__importDefault(require("path")),fs_extra_1=__importDefault(require("fs-extra")),runtime_type_enum_js_1=require("../../enum/runtime-type-enum.js"),ohos_shell_hap_task_js_1=require("./ohos-shell-hap-task.js"),task_names_js_1=require("../common/task-names.js"),generate_java_files_js_1=require("./generate-java-files.js"),log_combine_type_js_1=require("../../utils/log/log-combine-type.js"),lodash_1=require("lodash");var ShellTask=task_names_js_1.TaskNames.ShellTask;class CompileJavaWithJavac extends ohos_shell_hap_task_js_1.OhosShellHapTask{constructor(e){super(e,ShellTask.COMPILE_SHELL_JAVA_WITH_JAVAC),this._log=ohos_logger_js_1.OhosLogger.getLogger(CompileJavaWithJavac.name)}initTaskDepends(){this.module.registryDependsOnTask(this,new generate_java_files_js_1.GenerateJavaFiles(this.targetService))}taskShouldDo(){return this.targetData.getTargetStatus().is(runtime_type_enum_js_1.RuntimeTypeEnum.HARMONY_OS)}beforeTask(){fs_extra_1.default.emptyDirSync(this.pathInfo.getIntermediatesClassDir()),fs_extra_1.default.emptyDirSync(this.pathInfo.getIntermediatesShellClassDir())}doTaskAction(){const e=this.pathInfo;this.compileJavaFiles(e.getIntermediatesShellJavaDir(),e.getIntermediatesShellClassDir(),[this.sdkInfo.getAbilityShellJar(),this.sdkInfo.getAceJar(),this.sdkInfo.getAJar()]),this.compileJavaFiles(e.getIntermediatesJavaDir(),e.getIntermediatesClassDir(),[this.sdkInfo.getOhosJar()])}compileJavaFiles(e,s,t){const a=(new java_compile_command_builder_js_1.JavaCompileCommandBuilder).addJavaOption("-Duser.language=en").addJavaOption("-Duser.country=US").addEncoding("UTF-8").addTarget("8").addSource("8").addIndexFile(path_1.default.resolve(e,"javaList")).addDest(s).addClasspath(t.join(path_1.default.delimiter));this._log.debug(a.build());const i={commandLine:a.build(),commandOptions:{stdout:"ignore"},logCompileType:log_combine_type_js_1.LogCombineType.DEBUG};(new process_utils_js_1.ProcessUtils).submitSyncExecutionWithoutReturn(this.getWorkerPool(),i,lodash_1.noop,[],[0,1],log_combine_type_js_1.LogCombineType.DEBUG)}}exports.CompileJavaWithJavac=CompileJavaWithJavac;