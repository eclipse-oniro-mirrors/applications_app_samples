"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenerateNativeLibrary=void 0;const native_library_model_js_1=require("./native-library-model.js"),path_1=__importDefault(require("path"));class GenerateNativeLibrary{constructor(t,e,r,i,a){var s,l;this.library=new native_library_model_js_1.NativeLibraryModel,this.library.setAbi(r),this.library.setBuildCommandComponents(this.createBuildCommand(t,e)),this.library.setBuildType(a),this.library.setArtifactName(i.name),this.library.setFolders(this.findFolders(i)),this.library.setFiles(this.findFiles(i)),this.library.setOutputs(this.findOutputs(i)),this.library.setNameOnDisk(i.nameOnDisk),this.library.setRuntimeFiles(this.findRuntimeFiles(i)),this.library.setBuild(null===(s=i.paths)||void 0===s?void 0:s.build),this.library.setSource(null===(l=i.paths)||void 0===l?void 0:l.source)}getLibrary(){return this.library}createBuildCommand(t,e){return[path_1.default.resolve(t,"..","ninja.exe"),"-C",e]}findFolders(t){var e;const r=[];return null===(e=t.compileGroups)||void 0===e||e.forEach((t=>{var e;null===(e=t.includes)||void 0===e||e.forEach((t=>{t.path&&r.push(path_1.default.resolve(t.path))}))})),r}findFiles(t){var e;const r=[];return null===(e=t.sources)||void 0===e||e.forEach((t=>{t.path&&r.push(path_1.default.resolve(t.path))})),r}findOutputs(t){var e;const r=[];return null===(e=t.artifacts)||void 0===e||e.forEach((t=>{t.path&&r.push(t.path)})),r}findRuntimeFiles(t){var e,r,i,a;const s=[];let l=null===(r=null===(e=t.link)||void 0===e?void 0:e.sysroot)||void 0===r?void 0:r.path;return l&&(l=path_1.default.resolve(l)),null===(a=null===(i=t.link)||void 0===i?void 0:i.commandFragments)||void 0===a||a.forEach((t=>{if("libraries"!==t.role)return;let e=t.fragment;e&&(e.startsWith("-")||e.endsWith(".a")||(e=path_1.default.resolve(e),l&&e.startsWith(l)||s.push(path_1.default.resolve(e))))})),s}}exports.GenerateNativeLibrary=GenerateNativeLibrary;